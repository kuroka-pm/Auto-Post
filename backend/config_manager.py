"""
config_manager.py â€” config.json ã®èª­ã¿æ›¸ããƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

å…¨è¨­å®šã‚’ config.json ã«é›†ç´„ã—ã€GUI / ãƒ­ã‚¸ãƒƒã‚¯åŒæ–¹ã‹ã‚‰å‚ç…§ã™ã‚‹ã€‚
APIã‚­ãƒ¼ã¯ base64 é›£èª­åŒ–ã—ã¦ä¿å­˜ã™ã‚‹ã€‚
"""

import base64
import json
import sys
from pathlib import Path

# PyInstaller --onefile ã§ã¯ __file__ ãŒä¸€æ™‚å±•é–‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡ã™ãŸã‚ã€
# sys.executableï¼ˆexeæœ¬ä½“ã®å ´æ‰€ï¼‰ã‚’åŸºæº–ã«ã™ã‚‹
if getattr(sys, 'frozen', False):
    _BASE_DIR = Path(sys.executable).resolve().parent
else:
    # backend/ ã®è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª = ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ
    _BASE_DIR = Path(__file__).resolve().parent.parent

CONFIG_PATH = _BASE_DIR / "config.json"

# é›£èª­åŒ–å¯¾è±¡ã®ã‚­ãƒ¼åï¼ˆmodelåãªã©ã¯å¯¾è±¡å¤–ï¼‰
_SECRET_KEYS = {
    "gemini_api_key", "x_api_key", "x_api_secret",
    "x_access_token", "x_access_token_secret", "threads_api_key",
}
_OBF_PREFIX = "OBF:"


def _obfuscate(value: str) -> str:
    """å¹³æ–‡ã‚’ base64 é›£èª­åŒ–ã™ã‚‹ã€‚ç©ºæ–‡å­—åˆ—ã¯ãã®ã¾ã¾è¿”ã™ã€‚"""
    if not value or value.startswith(_OBF_PREFIX):
        return value
    encoded = base64.b64encode(value.encode("utf-8")).decode("ascii")
    return f"{_OBF_PREFIX}{encoded}"


def _deobfuscate(value: str) -> str:
    """é›£èª­åŒ–æ¸ˆã¿ã®å€¤ã‚’å¾©å·ã™ã‚‹ã€‚OBF: ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãªã‘ã‚Œã°å¹³æ–‡ã¨ã¿ãªã™ã€‚"""
    if not value or not value.startswith(_OBF_PREFIX):
        return value
    try:
        return base64.b64decode(value[len(_OBF_PREFIX):]).decode("utf-8")
    except Exception:
        return value  # å¾©å·å¤±æ•—æ™‚ã¯ãã®ã¾ã¾è¿”ã™


def get_default_config() -> dict:
    """main.py ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãŸå€¤ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦è¿”ã™ã€‚"""
    return {
        "api_keys": {
            "gemini_api_key": "",
            "gemini_model": "gemini-2.5-flash",
            "x_api_key": "",
            "x_api_secret": "",
            "x_access_token": "",
            "x_access_token_secret": "",
            "threads_api_key": "",
        },
        "persona": {
            "gender": "",
            "age": "",
            "occupation": "",
            "background": "",
            "hobbies": "",
            "personality": "",
            "first_person": "",
            "speech_style": "",
            "other": "",
            "generated_text": "",
        },
        "prompt_settings": {
            "writing_guidelines": (
                "## æ›¸ãæ–¹ã®æŒ‡é‡ï¼ˆã“ã®é †ç•ªã«æ„è­˜ã™ã‚‹ã“ã¨ï¼‰\n\n"
                "1. **ãƒ•ãƒƒã‚¯ã§å§‹ã‚ã‚**: å†’é ­1ã€œ2æ–‡ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æ­¢ã‚ã‚‹ã€‚æ„å¤–ãªäº‹å®Ÿã€å…·ä½“çš„ãªæ•°å­—ã€"
                "ã¾ãŸã¯å¸¸è­˜ã®é€†ã‚’çªãè¦–ç‚¹ã§å…¥ã‚‹ã€‚\n"
                "2. **1ã¤ã ã‘èªã‚Œ**: ãƒˆãƒ¬ãƒ³ãƒ‰ã¨è‡ªåˆ†ã®èƒŒæ™¯ï¼ˆç¾å ´çµŒé¨“ or ç°¿è¨˜ or ã‚¸ãƒ  or æ ª etc.ï¼‰ã®"
                "æ¥ç‚¹ã‚’ã€Œ1ã¤ã ã‘ã€è¦‹ã¤ã‘ã¦æ·±æ˜ã‚Šã™ã‚‹ã€‚è¤‡æ•°ã®èƒŒæ™¯ã‚’è©°ã‚è¾¼ã‚€ãªã€‚\n"
                "3. **èª­ã¿ã‚„ã™ã„æ”¹è¡Œã‚’å…¥ã‚Œã‚**: Xã¯ã‚¹ãƒãƒ›ã§èª­ã‚€äººãŒå¤šãã€ã‚«ãƒ©ãƒ å¹…ãŒç‹­ã„ã€‚"
                "æ„å‘³ã®ã¾ã¨ã¾ã‚Šã”ã¨ã«æ”¹è¡Œã‚’å…¥ã‚Œã€è¦–è¦šçš„ãªãƒªã‚ºãƒ ã‚’ä½œã‚Œã€‚"
                "1è¡ŒãŒ40æ–‡å­—ã‚’è¶…ãˆãŸã‚‰æ„å‘³ã®åˆ‡ã‚Œç›®ã§æ”¹è¡Œã—ã‚ã€‚"
                "å…¨ä½“ã‚’2ã€œ3ãƒ–ãƒ­ãƒƒã‚¯ã«åˆ†ã‘ã€ãƒ–ãƒ­ãƒƒã‚¯é–“ã«ç©ºè¡Œã‚’1ã¤å…¥ã‚Œã‚ã€‚"
                "ãŸã ã—ã€æ„å‘³ãŒé€šã˜ãªã„ä¸­é€”åŠç«¯ãªä½ç½®ã§æ”¹è¡Œã™ã‚‹ãªã€‚\n"
                "4. **ä½™éŸ»ã§çµ‚ã‚ã‚**: æœ€å¾Œã¯ã€Œäº‹å®Ÿã®æå†™ã€ã‹ã€Œä¹¾ã„ãŸæ„Ÿæƒ³ã€ã§ãƒ–ãƒ„åˆ‡ã‚Šã«ã™ã‚‹ã€‚"
                "æ•™è¨“ã€ã¾ã¨ã‚ã€å•ã„ã‹ã‘ã€å‰å‘ããªå®£è¨€ã§çµ‚ã‚ã‚‰ã›ã‚‹ãªã€‚\n"
                "5. **ä¸­å­¦ç”Ÿãƒ¬ãƒ™ãƒ«ã®å¹³æ˜“ã•**: é›£ã—ã„æ¼¢å­—ã¯ã²ã‚‰ãŒãªã«é–‹ãã€å°‚é–€ç”¨èªã¯æ—¥å¸¸ã®è¨€è‘‰ã«è¨€ã„æ›ãˆã‚‹ã€‚"
                "ã‚¹ãƒ«ã‚¹ãƒ«ã¨è„³ã«å…¥ã£ã¦ãã‚‹æ–‡ç« ã«ã™ã‚‹ã“ã¨ã€‚\n\n"
                "## æ›ã‘åˆã‚ã›ãƒ«ãƒ¼ãƒ«ï¼ˆå¿…ãšå®ˆã‚Œï¼‰\n\n"
                "- ãƒˆãƒ¬ãƒ³ãƒ‰ãƒã‚¿1ã¤ã«å¯¾ã—ã¦ã€ãƒšãƒ«ã‚½ãƒŠã®è¦ç´ ã¯ã€Œ1ã¤ã ã‘ã€ä½¿ã†\n"
                "- 1ã¤ã®ãƒã‚¹ãƒˆã§è¨€åŠã™ã‚‹ãƒ†ãƒ¼ãƒã¯ã€Œ1ã¤ã ã‘ã€\n"
                "- ã€Œãƒˆãƒ¬ãƒ³ãƒ‰ã®äº‹å®Ÿã€â†’ã€Œãƒšãƒ«ã‚½ãƒŠã®1è¦–ç‚¹ã‹ã‚‰ã®çŸ­ã„ã‚³ãƒ¡ãƒ³ãƒˆã€ã®2æ–‡æ§‹é€ ã‚’åŸºæœ¬ã¨ã™ã‚‹\n"
                "- è‡ªåˆ†èªã‚Šã¯æœ€å¤§2æ–‡ã¾ã§ã€‚ãã‚Œä»¥ä¸Šã¯å‰Šã‚‹\n"
                "- ã€Œå‰ã®ä¼šç¤¾ã€ã€Œé©å¿œéšœå®³ã€ãªã©ã®é‡ã„ãƒ†ãƒ¼ãƒã¯ã€ãƒˆãƒ¬ãƒ³ãƒ‰ã¨ã®æ›ã‘åˆã‚ã›ã§ã¯ä½¿ã‚ãªã„\n\n"
                "## å‡ºåŠ›å¾Œã®è‡ªå·±ãƒã‚§ãƒƒã‚¯ï¼ˆç”Ÿæˆå¾Œã«å¿…ãšå®Ÿè¡Œã›ã‚ˆï¼‰\n\n"
                "â–¡ æ”¹è¡Œãªã—ã§é•·ã„æ–‡ãŒç¶šã„ã¦ã„ãªã„ã‹ï¼Ÿ â†’ æ„å‘³ã®åŒºåˆ‡ã‚Šã§æ”¹è¡Œã‚’å…¥ã‚Œã‚‹\n"
                "â–¡ ã‚¹ãƒãƒ›ã§è¡¨ç¤ºã—ãŸæ™‚ã«å£ã®ã‚ˆã†ãªãƒ†ã‚­ã‚¹ãƒˆã«ãªã£ã¦ã„ãªã„ã‹ï¼Ÿ â†’ ãƒ–ãƒ­ãƒƒã‚¯åˆ†ã‘ã™ã‚‹\n"
                "â–¡ ç©ºè¡Œãƒ–ãƒ­ãƒƒã‚¯ãŒ3ã¤ã‚’è¶…ãˆã¦ã„ãªã„ã‹ï¼Ÿ â†’ ãƒ–ãƒ­ãƒƒã‚¯ã‚’çµ±åˆã—ã¦æ¸›ã‚‰ã™\n"
                "â–¡ æœ€å¾Œã«ã€Œã¾ã¨ã‚ã€ã‚„ã€Œæ•™è¨“ã€ã‚’å…¥ã‚Œã¦ã„ãªã„ã‹ï¼Ÿ â†’ å‰Šé™¤\n"
                "â–¡ ã€Œã€œã ã£ãŸã€‚ã€ãŒ3å›ä»¥ä¸Šé€£ç¶šã—ã¦ã„ãªã„ã‹ï¼Ÿ â†’ æ–‡æœ«ã‚’å¤‰ãˆã‚‹\n"
                "â–¡ èª­ã¿æ‰‹ãŒã€Œã§ï¼Ÿã€ã¨æ€ã†æ–‡ãŒãªã„ã‹ï¼Ÿ â†’ ãã®æ–‡ã‚’å‰Šé™¤"
            ),
            "ng_expressions": (
                "- ãƒã‚¨ãƒ : ã€Œã€œã®æ­¯è»ŠãŒã€ã€Œçµ¶æœ›çš„ã€ã€Œã€œã¨ã„ã†æ•°å­—ã¯å˜˜ã‚’ã¤ã‹ãªã„ã€ã®ã‚ˆã†ãªå¤§ã’ã•ãªæ¯”å–©\n"
                "- å•ã„ã‹ã‘: ã€Œçš†ã•ã‚“ã¯ï¼Ÿã€ã€Œã€œã§ã™ã‚ˆã­ã€\n"
                "- æ•™è¨“: ã€Œã€œã‚’å­¦ã‚“ã ã€ã€Œã€œã—ã¦ã„ããŸã„ã€ã€Œã€œãŒå¤§äº‹ã ã€\n"
                "- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°: ä¸€åˆ‡ä¸è¦\n"
                "- ãƒ“ã‚¸ãƒã‚¹ç”¨èªï¼ˆã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ã€PDCAãªã©ï¼‰ã€ä¸å¿…è¦ã«é›£ã—ã„ã‚«ã‚¿ã‚«ãƒŠèªã€æ¥­ç•Œã®å°‚é–€ç”¨èª\n"
                "- 1ãƒã‚¹ãƒˆã«3ã¤ä»¥ä¸Šã®ãƒ†ãƒ¼ãƒã‚’å«ã‚ãªã„\n"
                "- ã€Œçµå±€ã€œã€ã€Œã¤ã¾ã‚Šã€œã€ã§å§‹ã¾ã‚‹ç·æ‹¬æ–‡ã‚’å…¥ã‚Œãªã„ï¼ˆã‚¨ãƒƒã‚»ã‚¤åŒ–ã®å…†å€™ï¼‰\n"
                "- 500æ–‡å­—ã‚’è¶…ãˆãªã„ï¼ˆè¶…ãˆãŸå ´åˆã¯è‡ªå‹•ã§çŸ­ç¸®ã‚’è©¦ã¿ã‚‹ï¼‰"
            ),
            "writing_styles": [
                {
                    "name": "ä¸€æ’ƒã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼",
                    "weight": 5,
                    "char_range": "80ã€œ140æ–‡å­—",
                    "description": "ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’åˆ¶ä½œç¾å ´ã®è¦–ç‚¹ã§ä¸€è¨€ã«å‡ç¸®ã™ã‚‹ã€‚çµè«–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã€‚ä½™è¨ˆãªèª¬æ˜ãªã—ã€‚",
                    "structure": "ã€ãƒ•ãƒƒã‚¯1æ–‡ã€‘â†’ã€ä¹¾ã„ãŸä¸€è¡Œã®æ„Ÿæƒ³ã€‘",
                    "example": (
                        "å…¨ç¤¾DXæ¨é€²ã¨ã‹è¨€ã£ã¦ã‚‹ã‘ã©ã€ã†ã¡ã®ç¾å ´ã¯ã¾ã Redmineã®ãƒã‚±ãƒƒãƒˆã‚’Excelã«è»¢è¨˜ã—ã¦ãŸã€‚\n"
                        "\n"
                        "æ¨é€²ã™ã‚‹å´ãŒä¸€ç•ªã‚¢ãƒŠãƒ­ã‚°ã ã£ãŸã€‚"
                    ),
                },
                {
                    "name": "ãƒ‹ãƒ¥ãƒ¼ã‚¹Ã—ä¸€è¨€",
                    "weight": 4,
                    "char_range": "80ã€œ140æ–‡å­—",
                    "description": "ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«å¯¾ã—ã¦ä¸€è¨€ã ã‘ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹å‹ã€‚Xã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«æœ€ã‚‚å¼·ã„ã€‚äº‹å®Ÿã®å¼•ç”¨ï¼‹çŸ­ã„ç§è¦‹ã€‚",
                    "structure": "ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®è¦ç´„1æ–‡ã€‘â†’ã€è‡ªåˆ†ã®ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆã€‘",
                    "example": (
                        "ROG Ally XãŒ3ä¸‡å††å€¤ä¸Šã’ã€‚\n"
                        "\n"
                        "å††å®‰ãŒè¶£å‘³ã¾ã§æ®´ã£ã¦ãã‚‹æ™‚ä»£ã‹ã€‚"
                    ),
                },
                {
                    "name": "å…±æ„Ÿã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰",
                    "weight": 3,
                    "char_range": "140ã€œ250æ–‡å­—",
                    "description": "è‡ªåˆ†ã®éå»ã®å…·ä½“çš„ãªä½“é¨“1ã¤ã ã‘ã‚’åˆ‡ã‚Šå‡ºã—ã€ãƒˆãƒ¬ãƒ³ãƒ‰ã«æ¥ç¶šã™ã‚‹ã€‚èª­ã‚“ã äººãŒã€Œã‚ã‚‹ã‚ã‚‹ã€ã¨æ€ãˆã‚‹ãƒªã‚¢ãƒ«ã•ãŒå‘½ã€‚",
                    "structure": "ã€ãƒ•ãƒƒã‚¯ï¼ˆæ„å¤–ãªäº‹å®Ÿ/æ•°å­—ï¼‰ã€‘â†’ã€ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰å±•é–‹ï¼ˆ2ã€œ3æ–‡ï¼‰ã€‘â†’ã€ãƒ–ãƒ„åˆ‡ã‚Šã®ä½™éŸ»ã€‘",
                    "example": (
                        "ã€Œç´æœŸã¯å‹•ã‹ã›ã¾ã›ã‚“ã€ã£ã¦è¨€ã‚ã‚Œã¦ã€å‹•ã‹ã—ãŸã®ã¯ä¿ºã®ç”Ÿæ´»ãƒªã‚ºãƒ ã ã£ãŸã€‚\n"
                        "æœ9æ™‚ã«å‡ºç¤¾ã—ã¦ã€æ°—ã¥ã„ãŸã‚‰æœ4æ™‚ã€‚ä»•æ§˜æ›¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯8.3ã€‚\n"
                        "\n"
                        "æ•°å­—ã¯è£åˆ‡ã‚‰ãªã„ã€ã¨æ€ã£ãŸã‚ã‘ã˜ã‚ƒãªã„ã€‚\n"
                        "ãŸã ã€ç­”ãˆãŒ1ã¤ã—ã‹ãªã„ä¸–ç•ŒãŒæ¥½ã ã£ãŸã€‚"
                    ),
                },
                {
                    "name": "æ§‹é€ åˆ†æ",
                    "weight": 2,
                    "char_range": "140ã€œ280æ–‡å­—",
                    "description": "ãƒˆãƒ¬ãƒ³ãƒ‰ã®äº‹è±¡ã‚’ã€Œãªãœãã†ãªã‚‹ã‹ã€ã®æ§‹é€ ã§è…‘åˆ†ã‘ã™ã‚‹ã€‚æ„Ÿæƒ…ã‚’æ’ã—ã€æ·¡ã€…ã¨å› æœé–¢ä¿‚ã‚’è¿°ã¹ã‚‹ã€‚",
                    "structure": "ã€ãƒ•ãƒƒã‚¯ï¼ˆåå¸¸è­˜ã®åˆ‡ã‚Šå£ï¼‰ã€‘â†’ã€æ§‹é€ ã®è§£èª¬ï¼ˆ2ã€œ3æ–‡ï¼‰ã€‘â†’ã€ä½™éŸ»ã€‘",
                    "example": (
                        "å¤§ä¼æ¥­ã®DXãŒå¤±æ•—ã™ã‚‹ç†ç”±ã€æŠ€è¡“ã˜ã‚ƒãªã„ã€‚\n"
                        "ç¨Ÿè­°æ›¸ã®ãƒãƒ³ã‚³ã®æ•°ã ã€‚\n"
                        "\n"
                        "æ‰¿èªãƒ•ãƒ­ãƒ¼5æ®µéšã€ãã‚Œãã‚Œã®éƒ¨ç½²ãŒã€Œèã„ã¦ãªã„ã€ã‚’æã‚Œã¦ä¿èº«ã®ä¿®æ­£ã‚’å…¥ã‚Œã‚‹ã€‚\n"
                        "\n"
                        "å‰è·ã§ãã‚Œã‚’ã€Œä¼è¨€ã‚²ãƒ¼ãƒ é–‹ç™ºã€ã¨å‘¼ã‚“ã§ãŸã€‚\n"
                        "èª°ã‚‚ç¬‘ã‚ãªã‹ã£ãŸã€‚"
                    ),
                },
                {
                    "name": "æ¦‚å¿µã®å†å®šç¾©ï¼ˆç‹¬è‡ªç†è«–ï¼‰",
                    "weight": 3,
                    "char_range": "140ã€œ250æ–‡å­—",
                    "description": "èª°ã‚‚ãŒçŸ¥ã‚‹ç‹é“ã®ãƒ†ãƒ¼ãƒï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰ã«å¯¾ã—ã¦ã€è‡ªåˆ†ã®çµŒé¨“ã«åŸºã¥ã„ãŸç‹¬è‡ªã®æ–°ã—ã„å®šç¾©ï¼ˆã€‡ã€‡ã¨ã¯ã€â–³â–³ã§ã‚ã‚‹ï¼‰ã‚’æç¤ºã—ã€èª­è€…ã®è„³ã«ãƒ•ãƒƒã‚¯ã‚’ã‹ã‘ã‚‹ã€‚",
                    "structure": "ã€ãƒˆãƒ¬ãƒ³ãƒ‰äº‹è±¡ã®æç¤ºã€‘â†’ã€ç‹¬è‡ªã®å†å®šç¾©ï¼ˆã€‡ã€‡ã¨ã¯ã€å®Ÿã¯â–³â–³ã§ã‚ã‚‹ï¼‰ã€‘â†’ã€ç†ç”±ãƒ»è§£èª¬ï¼ˆ2ã€œ3æ–‡ï¼‰ã€‘â†’ã€ä½™éŸ»ã€‘",
                    "example": (
                        "ã€ŒAIã«ã‚ˆã‚‹æ¥­å‹™åŠ¹ç‡åŒ–ã€ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€‚\n"
                        "\n"
                        "AIå°å…¥ã¨ã¯ã€é­”æ³•ã®æ–ã§ã¯ãªãã€Œäººé–“ã®æ³¥è‡­ã„ãƒ‡ãƒãƒƒã‚°ä½œæ¥­ã®å§‹ã¾ã‚Šã€ã ã€‚\n"
                        "è¯ã‚„ã‹ãªãƒ—ãƒ¬ã‚¼ãƒ³ã®è£ã§ã€èª°ã‹ãŒæƒ³å®šå¤–ã®æŒ™å‹•ã‚’ä¸€ã¤ãšã¤æ‰‹ä½œæ¥­ã§æ½°ã—ã¦ã„ã‚‹ã€‚\n"
                        "\n"
                        "çµå±€ã€æ‰‹ã‚’å‹•ã‹ã™äººé–“ãŒä¸€ç•ªå¼·ã„ã€‚"
                    ),
                },
                {
                    "name": "æœ‰ç›Šãƒªã‚¹ãƒˆå‹",
                    "weight": 4,
                    "char_range": "200ã€œ280æ–‡å­—",
                    "description": "ã¾ã¨ã‚ãƒ»æ³•å‰‡ãƒ»Tipså½¢å¼ã€‚ä¿å­˜ï¼†RTã•ã‚Œã‚„ã™ã„ã€‚å…·ä½“çš„ãªæ•°å­—ã¨ç®‡æ¡æ›¸ãã§æ»åœ¨æ™‚é–“ã‚’ç¨¼ãã€‚",
                    "structure": "ã€ãƒ•ãƒƒã‚¯ï¼ˆå…·ä½“çš„æ•°å­—ï¼‹æ–­è¨€ï¼‰ã€‘â†’ã€ãƒªã‚¹ãƒˆ3ã€œ5é …ç›®ï¼ˆãƒ»ã‹æ•°å­—ï¼‰ã€‘â†’ã€ä½™éŸ»ã®ä¸€è¡Œã€‘",
                    "example": (
                        "400äººä»¥ä¸Šã¿ã¦ãã¦æ°—ã¥ã„ãŸã€\n"
                        "XãŒä¼¸ã³ãªã„äººã®å…±é€šç‚¹ã€‚\n"
                        "\n"
                        "ãƒ»æœ‰ç›Šãƒ„ã‚¤ãƒ¼ãƒˆã®æ¯”ç‡ãŒä½ã™ãã‚‹\n"
                        "ãƒ»è‡ªå·±é–‹ç¤ºãŒå¤šã™ãã¦èƒ¸ç„¼ã‘ã•ã›ã¦ã‚‹\n"
                        "ãƒ»å†…è¼ªãƒã‚¿ã§æ–°è¦ã‚’å¼¾ã„ã¦ã‚‹\n"
                        "ãƒ»å¿–åº¦ã§è§’ãŒãªã•ã™ãã‚‹\n"
                        "\n"
                        "ç©´ã®ç©ºã„ãŸãƒã‚±ãƒ„ã«æ°´æ³¨ã„ã§ã‚‚ã€\n"
                        "ãŸã¾ã‚‰ãªã„ã€‚"
                    ),
                },
                {
                    "name": "é€†èª¬ã‚¤ãƒ³ã‚µã‚¤ãƒˆå‹",
                    "weight": 4,
                    "char_range": "180ã€œ260æ–‡å­—",
                    "description": "å¸¸è­˜ã‚’å¦å®šã—ã¦å†å®šç¾©ã™ã‚‹ã€‚ã€Œã€‡ã€‡ï¼Ÿé•ã†ã€‚â–³â–³ï¼Ÿé•ã†ã€‚æœ¬å½“ã¯â–¡â–¡ã€ã®å¦å®šé€£é–ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ»åœ¨æ™‚é–“ã‚’æœ€å¤§åŒ–ã€‚",
                    "structure": "ã€é€šèª¬ã®æç¤ºã€‘â†’ã€å¦å®šã®é€£é–2ã€œ3å›ï¼ˆé•ã„ã¾ã™ï¼‰ã€‘â†’ã€çœŸã®ç­”ãˆï¼‹å…·ä½“ä¾‹ã€‘â†’ã€ä½™éŸ»ã€‘",
                    "example": (
                        "XãŒä¼¸ã³ãªã„åŸå› ã€‚\n"
                        "\n"
                        "ãƒã‚¹ãƒˆã®è³ªï¼Ÿé•ã†ã€‚\n"
                        "ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ï¼Ÿé•ã†ã€‚\n"
                        "ãƒªãƒ—å‘¨ã‚Šï¼Ÿãã‚Œã‚‚é•ã†ã€‚\n"
                        "\n"
                        "ä¼¸ã³ã¦ã‚‹äººã¨ä¼¸ã³ã¦ãªã„äººã€\n"
                        "ã‚„ã£ã¦ã‚‹ã“ã¨ã¯åŒã˜ã€‚\n"
                        "\n"
                        "é•ã†ã®ã¯ã€Œã‚„ã£ã¦ã„ãªã„ã“ã¨ã€ã ã£ãŸã€‚"
                    ),
                },
                {
                    "name": "å•ã„ã‹ã‘å…±æ„Ÿå‹",
                    "weight": 3,
                    "char_range": "120ã€œ200æ–‡å­—",
                    "description": "èª­è€…ã®ä½“é¨“ã«å¯„ã‚Šæ·»ã†å•ã„ã‹ã‘ã§ãƒªãƒ—ãƒ©ã‚¤ã‚’èª˜ç™ºã™ã‚‹ã€‚å…·ä½“çš„ãªã‚ã‚‹ã‚ã‚‹å ´é¢ã‚’æå†™ã—ã¦å…±æ„Ÿã‚’èµ·çˆ†å‰¤ã«ã™ã‚‹ã€‚",
                    "structure": "ã€å…±æ„Ÿã‚·ãƒ¼ãƒ³æå†™ï¼ˆã‚ã‚‹ã‚ã‚‹ãªä½“é¨“ï¼‰ã€‘â†’ã€å•ã„ã‹ã‘ or æ°—ã¥ãã€‘â†’ã€ä¸€è¡Œã®ä½™éŸ»ã€‘",
                    "example": (
                        "ä»•äº‹çµ‚ã‚ã‚Šã«ãƒ˜ãƒˆãƒ˜ãƒˆã§å¸°ã£ã¦ã€\n"
                        "1æ™‚é–“ã‹ã‘ã¦ãƒã‚¹ãƒˆä½œã£ã¦ã€\n"
                        "ã€Œä»Šæ—¥ã¯è‡ªä¿¡ã‚ã‚‹ã€ã¨æ€ã£ã¦æŠ•ç¨¿ã€‚\n"
                        "\n"
                        "ç¿Œæœã‚¹ãƒãƒ›é–‹ã„ãŸã‚‰ã€ã„ã„ã­3ä»¶ã€‚\n"
                        "\n"
                        "ã“ã‚Œã€ãƒã‚¹ãƒˆãŒæ‚ªã„ã‚“ã˜ã‚ƒãªã„ã€‚\n"
                        "ãƒã‚¹ãƒˆä»¥å‰ã®ã¨ã“ã‚ã§å‰Šã‚‰ã‚Œã¦ã‚‹ã€‚"
                    ),
                },
                {
                    "name": "ãƒ¦ãƒ¼ãƒ¢ã‚¢æ•™è¨“å‹",
                    "weight": 3,
                    "char_range": "150ã€œ280æ–‡å­—",
                    "description": "ã€ãƒˆãƒ¼ãƒ³èª¿æ•´æŒ‡ç¤ºã€‘ãƒšãƒ«ã‚½ãƒŠã®çŸ¥è­˜ãƒ»è¦–ç‚¹ãƒ»çµŒé¨“ã¯æ´»ã‹ã—ã¤ã¤ã€å£èª¿ã ã‘ã‚’æ¸©ã‹ãè¦ªã—ã¿ã‚„ã™ã„æ–¹å‘ã«ã‚·ãƒ•ãƒˆã›ã‚ˆã€‚æ—¥å¸¸ã®ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ï¼ˆé›»è»Šã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãƒ»æ–™ç†ãƒ»RPGãƒ»å¤©æ°—äºˆå ±ç­‰ï¼‰ã§ãƒšãƒ«ã‚½ãƒŠãªã‚‰ã§ã¯ã®æœ‰ç›Šæƒ…å ±ã‚’åŒ…ã‚ã€‚çµµæ–‡å­—ã¯ãƒšãƒ«ã‚½ãƒŠã«åˆã‚ã›ã¦æ§ãˆã‚ã«ï¼ˆæœ€å¤§1å€‹ã€ãªãã¦ã‚‚å¯ï¼‰ã€‚èªå°¾ã¯ã€Œã§ã™ã‚ˆã€ã€Œã§ã™ã‹ã‚‰ã­ã€ã€Œãã ã•ã„ã­ã€ã€Œã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€ç­‰ã®è‡ªç„¶ãªä¸å¯§èªã‚’ä½¿ã„ã¤ã¤ã€ãƒšãƒ«ã‚½ãƒŠã‚‰ã—ã„çš®è‚‰ã‚„æ´å¯Ÿã‚‚æ®‹ã›ã€‚ã€Œã”ã–ã„ã¾ã™ã€ã¯ä½¿ã†ãªã€‚ä½“è¨€æ­¢ã‚ã¯æ§ãˆã‚ã«ã€‚",
                    "structure": "ã€å‘¼ã³ã‹ã‘ï¼‹ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼å°å…¥ã€‘â†’ã€æœ‰ç›Šæƒ…å ±ã‚’ãƒ¦ãƒ¼ãƒ¢ã‚¢ã§å±•é–‹ï¼ˆ2ã€œ3æ–‡ï¼‰ã€‘â†’ã€ã‚«ãƒƒã‚³å†…ã§æœ¬å½“ã®æ„å‘³ã‚’ãƒãƒ©è¦‹ã›ã€‘â†’ã€æ¸©ã‹ã„ç· ã‚ã€‘",
                    "example": (
                        "æœ€è¿‘æŠ•è³‡ã‚’å§‹ã‚ãŸäººãŸã¡ã¸\n"
                        "\n"
                        "æœ¬æ—¥ã¯ã”ä¹—è»Šã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\n"
                        "æ—¥ã€…ã®å€¤å‹•ãã«ãƒ‰ã‚­ãƒ‰ã‚­ã€ä¸€å–œä¸€æ†‚ã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€\n"
                        "èµ°è¡Œä¸­ã«æ€¥ã«æ‰‹ã‚’é›¢ã™ï¼ˆæ‰‹æ”¾ã™ï¼‰ã®ã¯å¤§å¤‰å±é™ºã§ã™âš ï¸\n"
                        "\n"
                        "ãŸã¾ã«ãƒ’ãƒ¤ãƒƒã¨ã™ã‚‹æ€¥é™ä¸‹ã‚‚ã”ã–ã„ã¾ã™ãŒã€\n"
                        "åŸºæœ¬çš„ã«ã¯æ™‚é–“ã‚’ã‹ã‘ã¦ç€å®Ÿã«ç™»ã£ã¦ã„ãè¨­è¨ˆã¨ãªã£ã¦ãŠã‚Šã¾ã™ğŸ“ˆ\n"
                        "ã©ã†ã‹æœ€å¾Œã¾ã§ã—ã£ã‹ã‚Šã¨æ¡ã£ãŸã¾ã¾ï¼ˆã‚¬ãƒãƒ›ã§ï¼‰ã€\n"
                        "ã‚´ãƒ¼ãƒ«ã¾ã§ãŠé€²ã¿ãã ã•ã„ã­âœ¨\n"
                        "\n"
                        "ãã‚Œã§ã¯ã€ã‚ˆã„æŠ•è³‡ã®æ—…ã‚’ï¼ğŸ‘‹"
                    ),
                },
            ],
        },
        "sources": {
            "rss_urls": [],
            "blacklist": [],
        },
        "schedule": {
            "fixed_times": ["09:00", "18:00"],
            "jitter_minutes": 15,
            "post_to_x": True,
            "post_to_threads": False,
            "active_days": [0, 1, 2, 3, 4, 5, 6],
            "threads_token_issued": 0,
        },
        "post_type": {
            "type_a_ratio": 3,  # ãƒˆãƒ¬ãƒ³ãƒ‰é€£å‹•ã®æ¯”ç‡
            "type_b_ratio": 1,  # ç‹¬ç«‹ãƒã‚¹ãƒˆã®æ¯”ç‡
            "type_c_ratio": 1,  # noteå‘ŠçŸ¥ã®æ¯”ç‡
            "type_a_styles": ["ä¸€æ’ƒã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼", "ãƒ‹ãƒ¥ãƒ¼ã‚¹Ã—ä¸€è¨€"],
            "type_b_styles": ["å…±æ„Ÿã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰", "æ§‹é€ åˆ†æ", "æ¦‚å¿µã®å†å®šç¾©ï¼ˆç‹¬è‡ªç†è«–ï¼‰", "æœ‰ç›Šãƒªã‚¹ãƒˆå‹", "é€†èª¬ã‚¤ãƒ³ã‚µã‚¤ãƒˆå‹", "å•ã„ã‹ã‘å…±æ„Ÿå‹", "ãƒ¦ãƒ¼ãƒ¢ã‚¢æ•™è¨“å‹"],
        },
        "note_promotion": {
            "articles": [
                # {"url": "https://note.com/xxx/n/yyy",
                #  "title": "è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«",
                #  "summary": "è¨˜äº‹ã®æ¦‚è¦ï¼ˆä»»æ„ï¼‰"}
            ],
            "promotion_styles": [
                {
                    "name": "ã•ã‚Šã’ãªã„ç´¹ä»‹",
                    "weight": 3,
                    "prompt": (
                        "ã“ã®è¨˜äº‹ã®å†…å®¹ã«è»½ãè§¦ã‚ŒãªãŒã‚‰ã€ã€Œã“ã†ã„ã†è©±ã‚’æ›¸ãã¾ã—ãŸã€ã¨"
                        "ã•ã‚Šã’ãªãç´¹ä»‹ã—ã¦ãã ã•ã„ã€‚æŠ¼ã—ä»˜ã‘ãŒã¾ã—ã•ã‚¼ãƒ­ã§ã€‚"
                    ),
                },
                {
                    "name": "å†å‘ŠçŸ¥ãƒ»æ˜ã‚Šèµ·ã“ã—",
                    "weight": 2,
                    "prompt": (
                        "éå»ã«æ›¸ã„ãŸè¨˜äº‹ã‚’å†åº¦ç´¹ä»‹ã™ã‚‹ä½“ã§æ›¸ã„ã¦ãã ã•ã„ã€‚"
                        "ã€Œå‰ã«æ›¸ã„ãŸè¨˜äº‹ãŒæ„å¤–ã¨èª­ã¾ã‚Œã¦ã¦ã€ã€Œãµã¨æ€ã„å‡ºã—ãŸè¨˜äº‹ã€ã®ã‚ˆã†ãª"
                        "è‡ªç„¶ãªå°å…¥ã‹ã‚‰å…¥ã‚‹ã“ã¨ã€‚"
                    ),
                },
                {
                    "name": "ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰é€£å‹•",
                    "weight": 2,
                    "prompt": (
                        "è¨˜äº‹ã®å†…å®¹ã«é–¢é€£ã™ã‚‹çŸ­ã„å€‹äººçš„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ï¼ˆ2ã€œ3æ–‡ï¼‰ã‚’èªã‚Šã€"
                        "ã€Œã“ã®è©±ã€noteã«è©³ã—ãæ›¸ãã¾ã—ãŸã€ã¨è‡ªç„¶ã«ã¤ãªã’ã¦ãã ã•ã„ã€‚"
                    ),
                },
                {
                    "name": "å•é¡Œæèµ·å‹",
                    "weight": 2,
                    "prompt": (
                        "è¨˜äº‹ã®ãƒ†ãƒ¼ãƒã«é–¢ã™ã‚‹å•é¡Œæèµ·ã‚„ç–‘å•ã‚’1ã€œ2æ–‡ã§æŠ•ã’ã‹ã‘ã€"
                        "ã€Œã“ã®è¾ºã®è©±ã‚’noteã«ã¾ã¨ã‚ã¦ã¾ã™ã€ã¨ç¶šã‘ã¦ãã ã•ã„ã€‚"
                        "èª­ã¿æ‰‹ãŒã€Œæ°—ã«ãªã‚‹ã€ã¨æ€ãˆã‚‹åˆ‡ã‚Šå£ã§ã€‚"
                    ),
                },
                {
                    "name": "å­¦ã³ãƒ»æ°—ã¥ãå…±æœ‰",
                    "weight": 2,
                    "prompt": (
                        "è¨˜äº‹ã‚’æ›¸ãéç¨‹ã§å¾—ãŸæ°—ã¥ãã‚„å­¦ã³ã‚’1ã¤ã ã‘çŸ­ãå…±æœ‰ã—ã€"
                        "ã€Œè©³ã—ãã¯noteã«æ›¸ã„ãŸã®ã§è‰¯ã‹ã£ãŸã‚‰ã€ã¨ã¤ãªã’ã¦ãã ã•ã„ã€‚"
                        "ä¸Šã‹ã‚‰ç›®ç·šã«ãªã‚‰ãªã„ã“ã¨ã€‚"
                    ),
                },
            ],
        },
        "last_tab": "",
    }


def _deep_merge(base: dict, override: dict) -> dict:
    """base ã®æ§‹é€ ã‚’ç¶­æŒã—ã¤ã¤ override ã®å€¤ã§ä¸Šæ›¸ãã™ã‚‹ã€‚

    override ã«å­˜åœ¨ã—ãªã„ã‚­ãƒ¼ã¯ base ã®å€¤ã‚’ä¿æŒã™ã‚‹ã€‚
    """
    merged = base.copy()
    for key, value in override.items():
        if key in merged and isinstance(merged[key], dict) and isinstance(value, dict):
            merged[key] = _deep_merge(merged[key], value)
        else:
            merged[key] = value
    return merged


def load_config() -> dict:
    """è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã€‚å­˜åœ¨ã—ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”Ÿæˆã—ã¦è¿”ã™ã€‚

    APIã‚­ãƒ¼ã¯è‡ªå‹•çš„ã«å¾©å·ã•ã‚Œã€ãƒ¡ãƒ¢ãƒªä¸Šã§ã¯å¹³æ–‡ã¨ã—ã¦æ‰±ã†ã€‚
    """
    default = get_default_config()
    if not CONFIG_PATH.exists():
        save_config(default)
        return default

    with open(CONFIG_PATH, "r", encoding="utf-8") as f:
        data = json.load(f)

    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ãƒãƒ¼ã‚¸ã—ã¦ã€æ–°è¦è¿½åŠ ã‚­ãƒ¼ã‚’è£œå®Œ
    merged = _deep_merge(default, data)

    # APIã‚­ãƒ¼ã‚’å¾©å·
    api = merged.get("api_keys", {})
    for key in _SECRET_KEYS:
        if key in api:
            api[key] = _deobfuscate(api[key])

    return merged


def save_config(data: dict) -> None:
    """è¨­å®šã‚’ config.json ã«æ›¸ãå‡ºã™ã€‚APIã‚­ãƒ¼ã¯é›£èª­åŒ–ã—ã¦ä¿å­˜ã™ã‚‹ã€‚"""
    # å…ƒãƒ‡ãƒ¼ã‚¿ã‚’æ”¹å¤‰ã—ãªã„ã‚ˆã†æ·±ã„ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
    import copy
    to_save = copy.deepcopy(data)

    # APIã‚­ãƒ¼ã‚’é›£èª­åŒ–
    api = to_save.get("api_keys", {})
    for key in _SECRET_KEYS:
        if key in api:
            api[key] = _obfuscate(api[key])

    with open(CONFIG_PATH, "w", encoding="utf-8") as f:
        json.dump(to_save, f, ensure_ascii=False, indent=2)
